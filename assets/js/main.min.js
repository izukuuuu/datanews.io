(function($) {
    "use strict";

    // Sticky header
    $(window).on("scroll", function() {
        if ($(this).scrollTop() > 0) {
            $(".sticky-header").addClass("sticky");
        } else {
            $(".sticky-header").removeClass("sticky");
        }
    });

    // Set background image from data attribute
    $("[data-bg-image]").each(function() {
        var $element = $(this);
        var imageUrl = $element.data("bg-image");
        $element.css("background-image", "url(" + imageUrl + ")");
    });

    // Set background color from data attribute
    $("[data-bg-color]").each(function() {
        var $element = $(this);
        var color = $element.data("bg-color");
        $element.css("background-color", color);
    });

    // Initialize Swiper sliders
    new Swiper(".slider-container.swiper-container", {
        spaceBetween: 30,
        centeredSlides: true,
        speed: 3000,
        autoplay: false,
        loop: true,
        effect: "fade",
        fadeEffect: {
            crossFade: true
        }
    });

    new Swiper(".testimonial-carousel", {
        spaceBetween: 30,
        slidesPerView: 1,
        centeredSlides: true,
        roundLengths: true,
        loop: true,
        loopAdditionalSlides: 30,
        pagination: {
            el: ".swiper-pagination",
            clickable: true
        }
    });

    // Magnific Popup for video
    $(".video-popup").magnificPopup({
        type: "iframe"
    });

    // Mobile menu
    $(".header-action-btn-menu").on("click", function() {
        $(".header-action-btn-menu").addClass("open");
        $(".mobile-menu-wrapper").addClass("open");
    });

    $(".offcanvas-btn-close, .offcanvas-overlay").on("click", function() {
        $(".header-action-btn-menu").removeClass("open");
        $(".mobile-menu-wrapper").removeClass("open");
    });

    // Search
    $(".header-action-search").on("click", function() {
        $("body").addClass("fix");
        $(".offcanvas-search").addClass("open");
    });

    $(".offcanvas-btn-close, .body-overlay").on("click", function() {
        $("body").removeClass("fix");
        $(".offcanvas-search").removeClass("open");
    });

    // Mobile menu expand
    var $mobileMenu = $(".mobile-menu, .category-menu");
    $mobileMenu.find(".dropdown").slideUp();

    $mobileMenu.on("click", "li a, li .menu-expand", function(e) {
        var $menuItem = $(this);
        if ($menuItem.parent().hasClass("menu-item-has-children") || $menuItem.parent().hasClass("has-children") || $menuItem.parent().hasClass("has-sub-menu")) {
            if ($menuItem.attr("href") === "#" || $menuItem.hasClass("menu-expand")) {
                e.preventDefault();
                var $submenu = $menuItem.siblings("ul");
                if ($submenu.length) {
                    if ($submenu.is(":visible")) {
                        $menuItem.parent("li").removeClass("active");
                        $submenu.slideUp();
                    } else {
                        $menuItem.parent("li").addClass("active");
                        $menuItem.closest("li").siblings("li").removeClass("active").find("li").removeClass("active");
                        $menuItem.closest("li").siblings("li").find("ul:visible").slideUp();
                        $submenu.slideDown();
                    }
                }
            }
        }
    });

    // AOS initialization
    $(window).on("load", function() {
        AOS.init({ once: true });
    });

    // Gallery filter
    $(".gallery-filter-nav").on("click", "button", function() {
        var filterValue = $(this).attr("data-filter");
        $gallery.isotope({ filter: filterValue });
        $(this).siblings(".active").removeClass("active");
        $(this).addClass("active");
    });

    // Isotope for gallery
    var $gallery = $(".gallery-filter-wrapper").isotope({
        itemSelector: ".filter-item",
        percentPosition: true
    });

    // Initialize brand slider
    new Swiper(".brand-slider.swiper-container", {
        slidesPerView: 1,
        loop: true,
        pagination: false,
        breakpoints: {
            0: { slidesPerView: 2, spaceBetween: 80 },
            480: { slidesPerView: 3, spaceBetween: 140 },
            768: { slidesPerView: 4, spaceBetween: 140 },
            992: { slidesPerView: 4, spaceBetween: 200 },
            1200: { slidesPerView: 5, spaceBetween: 140 }
        }
    });

    // Mailchimp form submission
    $("#mc-form").ajaxChimp({
        language: "en",
        callback: function(response) {
            if (response.result === "success") {
                $(".mailchimp-success").html("" + response.msg).fadeIn(900);
                $(".mailchimp-error").fadeOut(400);
            } else if (response.result === "error") {
                $(".mailchimp-error").html("" + response.msg).fadeIn(900);
            }
        },
        url: "http://devitems.us11.list-manage.com/subscribe/post?u=6bbb9b6f5827bd842d9640c82&id=05d85f18ef"
    });

    // Contact form submission
    $(function() {
        var $contactForm = $("#contact-form");
        var $formMessage = $(".form-messege");

        $contactForm.on("submit", function(e) {
            e.preventDefault();
            var formData = $(this).serialize();
            $.ajax({
                type: "POST",
                url: $(this).attr("action"),
                data: formData
            }).done(function(response) {
                $formMessage.removeClass("error").addClass("success").text(response);
                $("#contact-form input, #contact-form textarea").val("");
            }).fail(function(response) {
                $formMessage.removeClass("success").addClass("error");
                if (response.responseText !== "") {
                    $formMessage.text(response.responseText);
                } else {
                    $formMessage.text("Oops! An error occurred and your message could not be sent.");
                }
            });
        });
    });

    // Scroll to top button
    var $scrollTop = $("#scroll-top");
    var lastScrollTop = 0;

    $(window).on("scroll", function() {
        var scrollTop = $(this).scrollTop();
        if (!(lastScrollTop < scrollTop) && scrollTop > 200) {
            $scrollTop.addClass("show");
        } else {
            $scrollTop.removeClass("show");
        }
        lastScrollTop = scrollTop;
    });

    $scrollTop.on("click", function(e) {
        $("html, body").animate({ scrollTop: 0 }, 600);
        e.preventDefault();
    });

})(jQuery);
